{% extends 'base.html' %}
{% load static %}

{% block title %}ì˜¨ìƒˆë™ë¬¼ì˜ë£Œì„¼í„°-ì¹˜ë£Œì¼€ì´ìŠ¤{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/intro.css' %}">
<link rel="stylesheet" href="{% static 'css/cases.css' %}">
{% endblock %}

{% block content %}
<!-- ë°°ë„ˆ ì„¹ì…˜ -->
<div class="intro-banner">
  <div class="banner-overlay">
    <div class="banner-content">
      <h2>MEDICAL CASE</h2>
      <h1>ì¹˜ë£Œì¼€ì´ìŠ¤</h1>
    </div>
  </div>
</div>

<!-- ì½˜í…ì¸  ì„¹ì…˜ -->
<div class="cases-container">
  <div class="inner">
    <!-- ì œëª© ì˜ì—­ -->
    <div class="title-area">
      <div class="title-line"></div>
      <h2>ì¹˜ë£Œì¼€ì´ìŠ¤</h2>
    </div>
    
    <!-- íƒ­ ë©”ë‰´ -->
    <div class="cases-tabs">
      <a href="?category=all" class="tab-btn {% if category == 'all' %}active{% endif %}">ì „ì²´</a>
      <a href="?category=internal" class="tab-btn {% if category == 'internal' %}active{% endif %}">ë‚´ê³¼</a>
      <a href="?category=surgery" class="tab-btn {% if category == 'surgery' %}active{% endif %}">ì™¸ê³¼</a>
      <a href="?category=dental" class="tab-btn {% if category == 'dental' %}active{% endif %}">ì¹˜ê³¼+ì•ˆê³¼</a>
    </div>
    
    <!-- ê²€ìƒ‰ ê¸°ëŠ¥ -->
    <div class="search-container">
      <form method="GET" class="search-box">
        <input type="hidden" name="category" value="{{ category }}">
        <select name="search_category" class="search-category">
          <option value="all" {% if search_category == 'all' %}selected{% endif %}>ì „ì²´</option>
          <option value="title" {% if search_category == 'title' %}selected{% endif %}>ì œëª©</option>
          <option value="content" {% if search_category == 'content' %}selected{% endif %}>ë‚´ìš©</option>
        </select>
        <input type="text" name="search" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{ search_query }}">
        <button type="submit" class="search-button">
          <i class="search-icon">ğŸ”</i>
        </button>
      </form>
    </div>
    
    <!-- ì¼€ì´ìŠ¤ ëª©ë¡ -->
    <div class="cases-list">
      {% for case in page_obj %}
      <div class="case-item">
        <div class="case-image">
          {% if case.image %}
            <img src="{{ case.image.url }}" alt="{{ case.title }}">
          {% else %}
            <img src="{% static 'images/ì˜ˆì‹œ2.png' %}" alt="{{ case.title }}">
          {% endif %}
        </div>
        <div class="case-content">
          <div class="case-department">{{ case.get_category_display }}</div>
          <h3 class="case-title">
            <a href="{% url 'cases:detail' case.id %}">{{ case.title }}</a>
          </h3>
          <p class="case-desc">{{ case.content|truncatewords:15|striptags }}</p>
          <div class="case-meta">
            <span class="case-date">{{ case.created_at|date:"Y.m.d" }}</span>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="no-results">
        <p>ë“±ë¡ëœ ì¹˜ë£Œì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
      {% endfor %}
    </div>
    
    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page=1{% if search_query %}&search={{ search_query }}&search_category={{ search_category }}{% endif %}{% if category != 'all' %}&category={{ category }}{% endif %}" class="page-nav">&laquo;</a>
        <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}&search_category={{ search_category }}{% endif %}{% if category != 'all' %}&category={{ category }}{% endif %}" class="page-nav">&lt;</a>
      {% endif %}
      
      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <span class="page-number active">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}&search_category={{ search_category }}{% endif %}{% if category != 'all' %}&category={{ category }}{% endif %}" class="page-number">{{ num }}</a>
        {% endif %}
      {% endfor %}
      
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}&search_category={{ search_category }}{% endif %}{% if category != 'all' %}&category={{ category }}{% endif %}" class="page-nav">&gt;</a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}&search_category={{ search_category }}{% endif %}{% if category != 'all' %}&category={{ category }}{% endif %}" class="page-nav">&raquo;</a>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  // ì¹´ë“œ í´ë¦­ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
  document.addEventListener('DOMContentLoaded', function() {
    const caseItems = document.querySelectorAll('.case-item');
    
    caseItems.forEach(item => {
      item.addEventListener('click', function(e) {
        // ë§í¬ë¥¼ ì§ì ‘ í´ë¦­í•œ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´
        if (!e.target.closest('a')) {
          const link = this.querySelector('.case-title a');
          if (link) {
            window.location.href = link.href;
          }
        }
      });
      
      // í˜¸ë²„ íš¨ê³¼ë¥¼ ìœ„í•œ ì»¤ì„œ ì„¤ì •
      item.style.cursor = 'pointer';
    });
  });
</script>
{% endblock %}